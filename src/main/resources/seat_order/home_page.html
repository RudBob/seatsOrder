<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/seatsOrder/static/bootstraps/css/bootstrap.min.css">
    <link rel="stylesheet" href="/seatsOrder/static/Font-Awesome-3.2.1/css/font-awesome.min.css"/>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            background-image: url(/seatsOrder/static/img/bg.jpg);
        }

        h1 {
            font-size: 70px;
            font-family: "黑体";
            text-align: center;
            vertical-align: middle;
            color: #fff;
            padding-top: 50px;
            padding-bottom: 50px;
            background-color: #000;
        }

        /*input{
            width: 750px;
            height: 50px;
            font-size: 30px;
        }*/
        #middle {
            margin-top: 200px;
            text-align: center;
            font-size: 12px;
        }

        .p {
            margin-bottom: 70px;
        }

        .button {
            width: 550px;
            height: 70px;
            background-color: blue;
            font-size: 45px;
            color: #fff;
        }

        .icon-5x {
            font-size: 5em;
        }

        .modal-dialog {
            position: relative;
            width: 500px;
            margin: 40px auto;
            background: white;
            border-radius: 5px;
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #e5e5e5;
        }

        .modal-header > i {
            font-weight: bold;
            color: #ADADAD;
            float: right;
            cursor: pointer;
        }

        .modal-body {
            position: relative;
            padding: 15px;
            height: 400px;
            overflow-y: auto;

        }

        .modal-body input {
            width: 450px;
            border-radius: 4px;
            border: 1px solid #DDDDDD;
            outline: none;
            padding: 10px;
            margin: 10px;
        }

        .modal-footer {
            padding: 15px;
            text-align: right;
            border-top: 1px solid #e5e5e5;
        }

    </style>
</head>

<body>
<h1>座位预约管理系统</h1>
<div id="middle">
    <p class="p">
        <i class="icon-user icon-5x"></i>
        <button type="submit" id="personal" class="button">个人中心</button>
    </p>
    <p class="p">
        <i class="icon-list icon-5x"></i>
        <button type="submit" id="order_seat" class="button">预约座位</button>
        <button type="submit" id="cancel_order" class="button">取消预约</button>
    </p>
    <p class="p">
        <i class="icon-stop icon-5x"></i>
        <button type="submit" id="start" class="button" data-toggle="modal" data-target="#modal_start">开始使用</button>
        <button type="submit" id="over" class="button">结束使用</button>
    </p>
    <p class="p">
        <i class="icon-time icon-5x"></i>
        <button type="submit" id="temp" class="button">暂离</button>
        <button type="submit" id="return" class="button">返回</button>
    </p>
    <p class="p">
        <i class="icon-plus icon-5x"></i>
        <button type="submit" id="continue" class="button">续座</button>
    </p>
    <!--开始使用的模态框-->
    <div class="modal fade" id="modal_start">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">开始使用</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- 模态框主体 -->
                <div class="modal-body" style="font-size: 20px;">
                    <!--<p><input type="text" placeholder="可对用户和座位进行投诉或建议"/></p>-->
                    <p>开始使用时间<input id="start_time" type="text" placeholder="year-month-day hh:mm:ss"/></p>
                    <p>结束使用时间<input id="over_time" type="text" placeholder="year-month-day hh:mm:ss"/></p>
                <!-- 模态框底部 -->
                <div class="modal-footer">
                    <button type="button" id="btn_ok" class="btn btn-secondary" data-dismiss="modal">确定</button>
                </div>

            </div>
        </div>
    </div>
</div>
</div>
<script type="text/javascript" src="/seatsOrder/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/seatsOrder/static/bootstraps/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/seatsOrder/static/layer/layer.js"></script>
<script type="text/javascript" src="/seatsOrder/static/js/base.js"></script>
<script type="text/javascript">
    $(function () {
        $("#cancel_order").hide();
        $("#return").hide();
        $("#over").hide();
        //个人中心、
        $("#personal").click(function () {
            location.href = "/seatsOrder/personal.html";
        });
        //预约座位
        $("#order_seat").click(function () {
            if(User.user.statuss == 0){
                window.location.href = '/seatsOrder/order_seat.html';
                $("#order_seat").hide();
                $("#cancel_order").show();
            }else{
                alert("用户只有在预约座位之前，才能预约座位！");
            }
        });
        //暂离
        $("#temp").click(function () {
            //用户正常使用座位时，才可以暂离座位
            if(User.user.statuss == 1){
                $("#temp").hide();
                //发送ajax
                var sid = User.user.sid;
                var tid = User.user.tid;
                var url = "/seatsOrder/seat/tempOut";
                var param = "sid=" + sid + "&tid=" + tid + "&outTimeMinutes=15";
                selectPageData(url, param, "post");
                afterthirtym();
                $("#return").show();
            }else{
                alert("用户正常使用座位时，才可以暂离座位!");
            }
        })
        //返回
        $("#return").click(function () {
            if(User.user.statuss == 3){
                $("#return").hide();
                //发送ajax
                var sid = User.user.sid;
                var tid = User.user.tid;
                var url = "/seatsOrder/seat/cancelTempOut";
                var param = "sid=" + sid + "&tid=" + tid;
                selectPageData(url, param, "post");
                $("#temp").show();
            }else{
                alert("用户只有在暂离座位后，才能取消暂离！");
            }

        })
        //续座
        $("#continue").click(function () {
            window.location.href = '/seatsOrder/continue_seat.html';
        });
        //开始使用
        $("#start").click(function () {
            if(User.user.statuss == 2){
                $("#btn_ok").click(function () {
                    var start_time = $("#start_time").val();
                    start_time = start_time.slice(0,9)+"T"+start_time.slice(11,18);
                    var over_time = $("#over_time").val();
                    var over_time = over_time.slice(0,9)+"T"+over_time.slice(11,18);
                    var sid = User.user.sid;
                    var tid = User.user.tid;
                    //发送ajax将座位释放
                    var url = "/seatsOrder/seat/outSeat";
                    var param = "sid=" + sid + "&tid=" + tid + "&startDatetime=" + start_time + "&endDatetime=" + over_time;
                    selectPageData(url, param, "post");
                    $("#start").hide();
                    $("over").show();
                });
            }else{
                alert("请先预约座位！");
            }
        });
        //结束使用
        $("#over").click(function () {
            if(User.user.statuss == 1){
                var sid = User.user.sid;
                //发送ajax将座位释放http://localhost:8080
                var url = "/seatsOrder/seat/outSeat";
                var param = "sid=" + sid;
                selectPageData(url, param, "post");
                $("#over").hide();
                $("#start").show();
            }else{
                alert("请确保用户正在使用座位，然后才可以正常结束使用！");
            }

        });
    })
    //调用ajax函数
    function selectPageData(url, param, type) {
            $.ajax({
            type : type,//请求方式
            url : url + "?" + param,//发送请求的地址
            async : true,//请求为异步请求
            success : function(data) {//成功时调用的回调函数
                // 返回操作是否成功
                if(data.code == 100){
                    alert("操作成功!");
                    location.href = "/seatsOrder/home_page.html"
                } else{
                    showMsg(data.message);					}
            },
            error : function() {//失败时被调用的函数
                alert("网络异常");
            }
        });
    }
    function showMsg(message) {
        alert(message);
    }
    function afterthirtym() {
        var hour = new Date().getHours();
        var minute = new Date().getMinutes();
        if ((minute + 20) >= 60) {
            hour++;
        }
        minute = (minute + 20) % 60;
        if (hour > 22) {
            alert("自习室即将关闭,不再提供暂离服务!");
        } else {
            alert("请于" + hour + ":" + minute + "返回");
        }
    }
</script>
</body>

</html>